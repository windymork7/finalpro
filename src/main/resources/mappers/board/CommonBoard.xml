<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.example.finalpro.dao.BoardDAO">
    <!--Q게시판 글쓰기-->
    <insert id="qBoardInsert" parameterType="com.example.finalpro.vo.QboardVO">
        INSERT INTO Q(q_no, mem_no, sub_ca_no, book_ca_no,  q_title, q_content, q_sos, q_up, q_rpt_cnt, q_admin_state)
         VALUES (Q_SEQ.NEXTVAL, #{mem_no}, #{sub_ca_no}, 0, #{q_title}, #{q_content}, 0, 0, 0, 0)
    </insert>

    <!--게시글 조회-->
    <select id="qBoardList" resultType="com.example.finalpro.vo.QboardVO">
        SELECT *
        FROM SUB_CA SA INNER JOIN
        (SELECT *
        FROM BOOK_CA BC INNER JOIN
        (SELECT *
        FROM MEM M1 RIGHT OUTER JOIN (SELECT * FROM Q) Q1
        ON M1.MEM_NO = Q1.MEM_NO) MQ
        ON BC.BOOK_CA_NO = MQ.BOOK_CA_NO) BCMQ
        ON SA.SUB_CA_NO = BCMQ.SUB_CA_NO
        WHERE SA.SUB_CA_NO = #{param1}
    </select>

    <!-- 해당 게시글 조회-->
    <select id="qBoardContent" resultType="com.example.finalpro.vo.QboardVO">
        SELECT *
        FROM SUB_CA SC INNER JOIN
        (SELECT *
        FROM BOOK_CA BC INNER JOIN
        (SELECT *
        FROM MEM M1 RIGHT OUTER JOIN (SELECT * FROM Q WHERE Q_NO=#{param1}) Q1
        ON M1.MEM_NO = Q1.MEM_NO) MQ
        ON BC.BOOK_CA_NO = MQ.BOOK_CA_NO) BCMQ
        ON SC.SUB_CA_NO = BCMQ.SUB_CA_NO
        WHERE SC.SUB_CA_NO = #{param2}
    </select>
    
    <!-- 추천 체크 -->
    <select id="qBoardUpCheck" resultType="Integer">
		SELECT nvl(max(mem_no), 0)
			FROM 
				(SELECT MEM_NO 
				FROM UP 
				WHERE Q_NO=#{q_no} 
				AND MEM_NO=#{mem_no})
    </select>
    
    <!-- 추천 액션-->
    <update id="qBoardUpUpdate" parameterType="com.example.finalpro.vo.QboardVO">
        UPDATE Q SET Q_UP=Q_UP+1 WHERE Q_NO=#{q_no}
    </update>
    <insert id="qBoardUpInsert" parameterType="com.example.finalpro.vo.QboardVO">
        INSERT INTO UP VALUES(UP_SEQ.nextval,#{q_no},#{mem_no})
    </insert>
</mapper>