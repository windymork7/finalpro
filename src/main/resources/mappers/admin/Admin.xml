<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.example.finalpro.dao.AdminDAO">
    <!-- 신고 10개 넘은 애들 -->
    <select id="memRptList" resultType="com.example.finalpro.vo.CommonMemberVO">
        SELECT * FROM
        (select rownum,mem_no from mem WHERE MEM_RPT_CNT>10)r,
        MEM m ,
        (select * from grade) g
        WHERE r.mem_no = m.mem_no
        and m.grade_no = g.grade_no
        AND MEM_RPT_CNT>10
    </select>

    <!-- 블랙리스트로 보내버리는 액션 -->
    <update id="memBlackAction" parameterType="com.example.finalpro.vo.CommonMemberVO">
        UPDATE MEM SET MEM_BLACK_DATE = SYSDATE+4, MEM_RPT_CNT = 0 WHERE MEM_NO=#{mem_no}
    </update>

    <!-- 블랙리스트 -->
    <select id="memBlackList" resultType="com.example.finalpro.vo.CommonMemberVO">
        SELECT * FROM
        (SELECT ROWNUM,MEM_NO
        FROM MEM WHERE MEM_BLACK_DATE > SYSDATE)R,
        MEM M,
        (SELECT * FROM GRADE) G
        WHERE MEM_BLACK_DATE > SYSDATE
        AND R.MEM_NO=M.MEM_NO
        AND M.GRADE_NO = G.GRADE_NO
    </select>
    
    <!-- Q신고 10개 넘은 리스트 -->
    <select id="qRptList" resultType="com.example.finalpro.vo.QboardVO">
		SELECT rownum,Q1.*,M.MEM_NICK,SC.SUB_CA_NAME FROM 
		(SELECT ROWNUM,Q_NO FROM Q) R,
		(SELECT * FROM Q) Q1,
		(SELECT MEM_NO, MEM_NICK FROM MEM) M,
		(SELECT * FROM SUB_CA) SC
		WHERE R.Q_NO = Q1.Q_NO
		AND Q1.MEM_NO = M.MEM_NO
		AND Q1.SUB_CA_NO = SC.SUB_CA_NO
		AND Q_RPT_CNT>10
    </select>
	<!-- Q신고 10개 넘은거 삭제 -->
	<delete id="qDeleteAction" parameterType="com.example.finalpro.vo.QboardVO">
		DELETE Q WHERE Q_NO=#{param1}
	</delete>    
    
    <!-- 승인허가 리스트 -->
    <select id="bookStandByList" resultType="com.example.finalpro.vo.QboardVO">
		SELECT rownum,C.CA_NAME,SC.SUB_CA_NAME,BC.BOOK_CA_NAME,M.MEM_NICK,Q1.*,C.CA_NO FROM 
		(SELECT * FROM Q) Q1,
		(SELECT * FROM MEM) M,
		(SELECT * FROM SUB_CA) SC,
		(SELECT * FROM CA) C,
        (SELECT * FROM BOOK_CA) BC
		WHERE Q1.MEM_NO = M.MEM_NO
		AND Q1.SUB_CA_NO = SC.SUB_CA_NO
		AND SC.CA_NO = C.CA_NO
        AND Q1.BOOK_CA_NO = BC.BOOK_CA_NO
		AND Q_ADMIN_STATE=4
	</select>
	
	<!-- 승인 ( 책에 추가 )  필요 없는 컬럼
	<insert id="bookAddAction" parameterType="com.example.finalpro.vo.QboardVO">
		insert into test3 values(1)
	</insert> -->
	<!-- 승인 ( 어드빈 상태 5로 변경 )  -->
	<update id="bookAdminStateUpdate" parameterType="com.example.finalpro.vo.QboardVO">
		UPDATE Q SET Q_ADMIN_STATE=5 WHERE Q_NO=#{param1}
	</update>

</mapper>